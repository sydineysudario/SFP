<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gest√£o Financeira Pessoal - Vers√£o Corrigida</title>

    <!-- CDN Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Firebase Config (Substitua pelas suas credenciais) -->
    <script type="application/json" id="firebase-config">
    {
        "apiKey": "AIzaSyCqCUYuwos_h5Fdt9a6bjibX7CzfhaJUqQ",
        "authDomain": "sistemafinanceiropessoal-ddbe3.firebaseapp.com",
        "projectId": "sistemafinanceiropessoal-ddbe3",
        "storageBucket": "sistemafinanceiropessoal-ddbe3.firebasestorage.app",
        "messagingSenderId": "360949795018",
        "appId": "1:360949795018:web:863523b189a26879e44c33",
        "measurementId": "G-1B3R3EK1TY"
    }
    </script>

    <style>
        /* Estilos customizados */
        .tab-content {
            min-height: 500px;
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .modal {
            backdrop-filter: blur(4px);
        }

        /* Otimiza√ß√£o para PDF */
        @media print {
            body {
                font-size: 12px;
            }

            .no-print {
                display: none !important;
            }

            .tab-content {
                break-inside: avoid;
            }

            .chart-container {
                height: 250px;
            }
        }

        /* Gradientes customizados */
        .gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .gradient-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .gradient-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .gradient-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .gradient-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        /* Anima√ß√µes */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .pulse-success {
            animation: pulseSuccess 2s infinite;
        }

        @keyframes pulseSuccess {

            0%,
            100% {
                background-color: #10b981;
            }

            50% {
                background-color: #059669;
            }
        }

        /* Corre√ß√µes de valida√ß√£o visual */
        .input-error {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }

        .input-success {
            border-color: #10b981 !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
        }

        /* Toast corrigido */
        .toast-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 9999;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }

        .toast-container.show {
            transform: translateX(0);
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Tela de Login -->
    <div id="loginScreen" class="min-h-screen gradient-primary flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <div class="gradient-info w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-wallet text-3xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">FinanceControl Pro</h1>
                <p class="text-gray-600">Sistema Inteligente de Gest√£o Financeira</p>
            </div>

            <button onclick="loginWithGoogle()" id="loginBtn"
                class="w-full bg-red-500 text-white py-3 px-4 rounded-lg hover:bg-red-600 transition-all flex items-center justify-center space-x-2 font-semibold">
                <i class="fab fa-google"></i>
                <span>Entrar com Google</span>
            </button>

            <div class="mt-6 text-center text-sm text-gray-500">
                <p>Seus dados s√£o protegidos e criptografados</p>
            </div>
        </div>
    </div>

    <!-- Tela Principal do App -->
    <div id="appScreen" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-4 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <div class="gradient-info w-10 h-10 rounded-full flex items-center justify-center">
                            <i class="fas fa-wallet text-white"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">FinanceControl Pro</h1>
                            <p class="text-xs text-gray-500">Sistema Inteligente</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <img id="userPhoto" src="" alt="User" class="w-8 h-8 rounded-full">
                        <span id="userName" class="text-sm font-medium hidden md:block"></span>
                        <button onclick="logout()"
                            class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm transition-colors">
                            <i class="fas fa-sign-out-alt mr-1"></i>Sair
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navega√ß√£o por Tabs -->
        <nav class="bg-white border-b sticky top-16 z-30">
            <div class="container mx-auto px-4">
                <div class="flex flex-wrap space-x-1 py-2 overflow-x-auto">
                    <button onclick="showTab('dashboard')"
                        class="tab-btn px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap gradient-info text-white"
                        data-tab="dashboard">
                        <i class="fas fa-tachometer-alt mr-1"></i>Dashboard
                    </button>
                    <button onclick="showTab('receitas')"
                        class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 whitespace-nowrap"
                        data-tab="receitas">
                        <i class="fas fa-plus-circle mr-1"></i>Receitas
                    </button>
                    <button onclick="showTab('despesas')"
                        class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 whitespace-nowrap"
                        data-tab="despesas">
                        <i class="fas fa-minus-circle mr-1"></i>Despesas
                    </button>
                    <button onclick="showTab('patrimonio')"
                        class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 whitespace-nowrap"
                        data-tab="patrimonio">
                        <i class="fas fa-home mr-1"></i>Patrim√¥nio
                    </button>
                    <button onclick="showTab('projecao')"
                        class="tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 whitespace-nowrap"
                        data-tab="projecao">
                        <i class="fas fa-chart-line mr-1"></i>Proje√ß√£o
                    </button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto px-4 py-6">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">Dashboard Financeiro</h2>

                <!-- M√©tricas Principais -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="gradient-primary rounded-xl p-6 text-white fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Saldo Atual</p>
                                <p class="text-2xl font-bold" id="saldoAtual">R$ 0,00</p>
                                <p class="text-xs opacity-75 mt-1" id="percentualSaldo">0% vs m√™s anterior</p>
                            </div>
                            <i class="fas fa-wallet text-3xl opacity-70"></i>
                        </div>
                    </div>

                    <div class="gradient-success rounded-xl p-6 text-white fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Receitas do M√™s</p>
                                <p class="text-2xl font-bold" id="receitasMes">R$ 0,00</p>
                                <p class="text-xs opacity-75 mt-1" id="mediaReceitas">M√©dia: R$ 0,00</p>
                            </div>
                            <i class="fas fa-arrow-up text-3xl opacity-70"></i>
                        </div>
                    </div>

                    <div class="gradient-danger rounded-xl p-6 text-white fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Despesas do M√™s</p>
                                <p class="text-2xl font-bold" id="despesasMes">R$ 0,00</p>
                                <p class="text-xs opacity-75 mt-1" id="mediaDespesas">M√©dia: R$ 0,00</p>
                            </div>
                            <i class="fas fa-arrow-down text-3xl opacity-70"></i>
                        </div>
                    </div>

                    <div class="gradient-info rounded-xl p-6 text-white fade-in">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Economia Mensal</p>
                                <p class="text-2xl font-bold" id="economiaMensal">R$ 0,00</p>
                                <p class="text-xs opacity-75 mt-1" id="percentualEconomia">0% da receita</p>
                            </div>
                            <i class="fas fa-piggy-bank text-3xl opacity-70"></i>
                        </div>
                    </div>
                </div>

                <!-- Gr√°ficos -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-line mr-2 text-blue-500"></i>
                            Evolu√ß√£o Mensal
                        </h3>
                        <div class="chart-container">
                            <canvas id="evolucaoChart"></canvas>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-xl font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-pie mr-2 text-purple-500"></i>
                            Gastos por Categoria
                        </h3>
                        <div class="chart-container">
                            <canvas id="categoriaChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- √öltimas Transa√ß√µes -->
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-history mr-2 text-gray-500"></i>
                            √öltimas Transa√ß√µes
                        </h3>
                        <span class="text-sm text-gray-500" id="totalTransacoes">0 transa√ß√µes</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 font-semibold">Data</th>
                                    <th class="text-left py-3 px-4 font-semibold">Descri√ß√£o</th>
                                    <th class="text-left py-3 px-4 font-semibold">Categoria</th>
                                    <th class="text-right py-3 px-4 font-semibold">Valor</th>
                                    <th class="text-center py-3 px-4 font-semibold">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="transacoesTableBody">
                                <!-- Transa√ß√µes ser√£o carregadas aqui -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Receitas Tab -->
            <div id="receitas" class="tab-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">Controle de Receitas</h2>

                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                    <!-- Formul√°rio -->
                    <div class="xl:col-span-1">
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 flex items-center text-green-600">
                                <i class="fas fa-plus-circle mr-2"></i>
                                Nova Receita
                            </h3>
                            <form onsubmit="handleReceitaForm(event)" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700"
                                        for="receita-descricao">
                                        <i class="fas fa-file-alt mr-1"></i>Descri√ß√£o
                                    </label>
                                    <input name="descricao" id="receita-descricao" type="text" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                        placeholder="Ex: Sal√°rio Principal" maxlength="100">
                                    <div class="text-xs text-red-500 mt-1 hidden" id="receita-descricao-error"></div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700" for="receita-valor">
                                        <i class="fas fa-dollar-sign mr-1"></i>Valor
                                    </label>
                                    <input name="valor" id="receita-valor" type="text" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                        placeholder="1.000,00" oninput="formatCurrency(this)" data-max="999999999">
                                    <div class="text-xs text-red-500 mt-1 hidden" id="receita-valor-error"></div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700"
                                        for="receita-categoria">
                                        <i class="fas fa-tags mr-1"></i>Categoria
                                    </label>
                                    <select name="categoria" id="receita-categoria" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                        <option value="">Selecione uma categoria...</option>
                                        <option value="Sal√°rio">üíº Sal√°rio</option>
                                        <option value="Freelancer">üíª Freelancer</option>
                                        <option value="Investimentos">üìà Investimentos</option>
                                        <option value="Vendas">üõí Vendas</option>
                                        <option value="Aluguel">üè† Aluguel Recebido</option>
                                        <option value="Bonus">üéÅ B√¥nus</option>
                                        <option value="Outros">üìù Outros</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700" for="receita-data">
                                        <i class="fas fa-calendar mr-1"></i>Data
                                    </label>
                                    <input name="data" id="receita-data" type="date" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    <div class="text-xs text-red-500 mt-1 hidden" id="receita-data-error"></div>
                                </div>
                                <button type="submit" id="receitaSubmitBtn"
                                    class="w-full gradient-success text-white py-3 rounded-lg hover:opacity-90 transition-all font-semibold">
                                    <i class="fas fa-plus mr-2"></i>Adicionar Receita
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Resumo e Lista -->
                    <div class="xl:col-span-2 space-y-6">
                        <!-- Resumo -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="gradient-success rounded-xl p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm opacity-90">Total do M√™s</p>
                                        <p class="text-2xl font-bold" id="totalReceitasMes">R$ 0,00</p>
                                    </div>
                                    <i class="fas fa-chart-line text-3xl opacity-70"></i>
                                </div>
                            </div>
                            <div class="gradient-info rounded-xl p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm opacity-90">M√©dia Mensal</p>
                                        <p class="text-2xl font-bold" id="mediaReceitasMensal">R$ 0,00</p>
                                    </div>
                                    <i class="fas fa-calculator text-3xl opacity-70"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Lista de Receitas -->
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h4 class="text-lg font-semibold mb-4">Receitas Recentes</h4>
                            <div id="receitasList" class="space-y-3">
                                <!-- Receitas ser√£o carregadas aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Despesas Tab -->
            <div id="despesas" class="tab-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">Controle de Despesas</h2>

                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                    <!-- Formul√°rio -->
                    <div class="xl:col-span-1">
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 flex items-center text-red-600">
                                <i class="fas fa-minus-circle mr-2"></i>
                                Nova Despesa
                            </h3>
                            <form onsubmit="handleDespesaForm(event)" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700"
                                        for="despesa-descricao">
                                        <i class="fas fa-file-alt mr-1"></i>Descri√ß√£o
                                    </label>
                                    <input name="descricao" id="despesa-descricao" type="text" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                                        placeholder="Ex: Aluguel" maxlength="100">
                                    <div class="text-xs text-red-500 mt-1 hidden" id="despesa-descricao-error"></div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700" for="despesa-valor">
                                        <i class="fas fa-dollar-sign mr-1"></i>Valor
                                    </label>
                                    <input name="valor" id="despesa-valor" type="text" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"
                                        placeholder="500,00" oninput="formatCurrency(this)" data-max="999999999">
                                    <div class="text-xs text-red-500 mt-1 hidden" id="despesa-valor-error"></div>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700"
                                        for="despesa-categoria">
                                        <i class="fas fa-tags mr-1"></i>Categoria
                                    </label>
                                    <select name="categoria" id="despesa-categoria" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                                        <option value="">Selecione uma categoria...</option>
                                        <option value="Habita√ß√£o">üè† Habita√ß√£o</option>
                                        <option value="Alimenta√ß√£o">üçΩÔ∏è Alimenta√ß√£o</option>
                                        <option value="Transporte">üöó Transporte</option>
                                        <option value="Lazer">üéØ Lazer</option>
                                        <option value="Sa√∫de">‚öïÔ∏è Sa√∫de</option>
                                        <option value="Educa√ß√£o">üìö Educa√ß√£o</option>
                                        <option value="Roupas">üëï Roupas</option>
                                        <option value="Tecnologia">üíª Tecnologia</option>
                                        <option value="Contas">üìÑ Contas</option>
                                        <option value="Outros">üìù Outros</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700" for="despesa-data">
                                        <i class="fas fa-calendar mr-1"></i>Data
                                    </label>
                                    <input name="data" id="despesa-data" type="date" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                                    <div class="text-xs text-red-500 mt-1 hidden" id="despesa-data-error"></div>
                                </div>
                                <button type="submit" id="despesaSubmitBtn"
                                    class="w-full gradient-danger text-white py-3 rounded-lg hover:opacity-90 transition-all font-semibold">
                                    <i class="fas fa-plus mr-2"></i>Adicionar Despesa
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Resumo e Lista -->
                    <div class="xl:col-span-2 space-y-6">
                        <!-- Resumo -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="gradient-danger rounded-xl p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm opacity-90">Total do M√™s</p>
                                        <p class="text-2xl font-bold" id="totalDespesasMes">R$ 0,00</p>
                                    </div>
                                    <i class="fas fa-chart-line text-3xl opacity-70"></i>
                                </div>
                            </div>
                            <div class="gradient-warning rounded-xl p-6 text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm opacity-90">M√©dia Mensal</p>
                                        <p class="text-2xl font-bold" id="mediaDespesasMensal">R$ 0,00</p>
                                    </div>
                                    <i class="fas fa-calculator text-3xl opacity-70"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Lista de Despesas -->
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h4 class="text-lg font-semibold mb-4">Despesas Recentes</h4>
                            <div id="despesasList" class="space-y-3">
                                <!-- Despesas ser√£o carregadas aqui -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Patrim√¥nio Tab -->
            <div id="patrimonio" class="tab-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">Controle de Patrim√¥nio</h2>

                <!-- Resumo do Patrim√¥nio -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="gradient-success rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Total de Bens</p>
                                <p class="text-2xl font-bold" id="totalBens">R$ 0,00</p>
                                <p class="text-xs opacity-75 mt-1" id="quantidadeBens">0 itens</p>
                            </div>
                            <i class="fas fa-arrow-trend-up text-3xl opacity-70"></i>
                        </div>
                    </div>

                    <div class="gradient-danger rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Total de D√≠vidas</p>
                                <p class="text-2xl font-bold" id="totalDividas">R$ 0,00</p>
                                <p class="text-xs opacity-75 mt-1" id="quantidadeDividas">0 itens</p>
                            </div>
                            <i class="fas fa-arrow-trend-down text-3xl opacity-70"></i>
                        </div>
                    </div>

                    <div class="gradient-info rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm opacity-90">Patrim√¥nio L√≠quido</p>
                                <p class="text-2xl font-bold" id="patrimonioLiquido">R$ 0,00</p>
                                <p class="text-xs opacity-75 mt-1" id="statusPatrimonio">Positivo</p>
                            </div>
                            <i class="fas fa-balance-scale text-3xl opacity-70"></i>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                    <!-- Formul√°rio -->
                    <div class="xl:col-span-1">
                        <div class="bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-xl font-semibold mb-4 flex items-center text-blue-600">
                                <i class="fas fa-plus mr-2"></i>
                                Novo Item
                            </h3>
                            <form onsubmit="handlePatrimonioForm(event)" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700">
                                        <i class="fas fa-list mr-1"></i>Tipo
                                    </label>
                                    <select name="tipo" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione o tipo...</option>
                                        <option value="bem">üí∞ Bem (Ativo)</option>
                                        <option value="divida">üí≥ D√≠vida (Passivo)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700">
                                        <i class="fas fa-file-alt mr-1"></i>Descri√ß√£o
                                    </label>
                                    <input name="descricao" type="text" required maxlength="100"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="Ex: Casa, Carro, Financiamento...">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700">
                                        <i class="fas fa-dollar-sign mr-1"></i>Valor
                                    </label>
                                    <input name="valor" type="text" required data-max="9999999999"
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        placeholder="50.000,00" oninput="formatCurrency(this)">
                                </div>
                                <div>
                                    <label class="block text-sm font-semibold mb-2 text-gray-700">
                                        <i class="fas fa-tags mr-1"></i>Categoria
                                    </label>
                                    <select name="categoria" required
                                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                        <option value="">Selecione uma categoria...</option>
                                        <option value="Im√≥vel">üè† Im√≥vel</option>
                                        <option value="Ve√≠culo">üöó Ve√≠culo</option>
                                        <option value="Investimentos">üìà Investimentos</option>
                                        <option value="Poupan√ßa">üí∞ Poupan√ßa</option>
                                        <option value="Financiamento">üè¶ Financiamento</option>
                                        <option value="Cart√£o de Cr√©dito">üí≥ Cart√£o de Cr√©dito</option>
                                        <option value="Empr√©stimo">üí∏ Empr√©stimo</option>
                                        <option value="Outros">üìù Outros</option>
                                    </select>
                                </div>
                                <button type="submit" id="patrimonioSubmitBtn"
                                    class="w-full gradient-info text-white py-3 rounded-lg hover:opacity-90 transition-all font-semibold">
                                    <i class="fas fa-plus mr-2"></i>Adicionar Item
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Listas de Bens e D√≠vidas -->
                    <div class="xl:col-span-2">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Bens -->
                            <div class="bg-white rounded-xl p-6 shadow-lg">
                                <h3 class="text-xl font-semibold mb-4 text-green-700 flex items-center">
                                    <i class="fas fa-arrow-up mr-2"></i>Meus Bens
                                </h3>
                                <div id="bensList" class="space-y-3">
                                    <!-- Bens ser√£o carregados aqui -->
                                </div>
                            </div>

                            <!-- D√≠vidas -->
                            <div class="bg-white rounded-xl p-6 shadow-lg">
                                <h3 class="text-xl font-semibold mb-4 text-red-700 flex items-center">
                                    <i class="fas fa-arrow-down mr-2"></i>Minhas D√≠vidas
                                </h3>
                                <div id="dividasList" class="space-y-3">
                                    <!-- D√≠vidas ser√£o carregadas aqui -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Proje√ß√£o Tab -->
            <div id="projecao" class="tab-content hidden">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">Proje√ß√£o Financeira Anual</h2>

                <!-- Gr√°fico de Proje√ß√£o -->
                <div class="bg-white rounded-xl p-6 shadow-lg mb-8">
                    <h3 class="text-xl font-semibold mb-4 flex items-center">
                        <i class="fas fa-chart-bar mr-2 text-purple-500"></i>
                        Proje√ß√£o de Economia Mensal
                    </h3>
                    <div class="chart-container">
                        <canvas id="projecaoChart"></canvas>
                    </div>
                </div>

                <!-- Cen√°rios de Proje√ß√£o -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-6">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-exclamation-triangle text-yellow-500 text-2xl mr-3"></i>
                            <h3 class="text-lg font-bold text-yellow-700">Cen√°rio Conservador</h3>
                        </div>
                        <p class="text-3xl font-bold text-yellow-600 mb-3" id="cenarioConservador">R$ 0,00</p>
                        <p class="text-sm text-gray-600 mb-4">Economia at√© dezembro (70% da m√©dia atual)</p>
                        <div class="space-y-2 text-xs text-gray-500">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-yellow-500 mr-2"></i>
                                <span>Considera imprevistos</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-yellow-500 mr-2"></i>
                                <span>Gastos emergenciais +10%</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-yellow-500 mr-2"></i>
                                <span>Receita est√°vel</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-blue-50 border-2 border-blue-200 rounded-xl p-6">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-chart-line text-blue-500 text-2xl mr-3"></i>
                            <h3 class="text-lg font-bold text-blue-700">Cen√°rio Realista</h3>
                        </div>
                        <p class="text-3xl font-bold text-blue-600 mb-3" id="cenarioRealista">R$ 0,00</p>
                        <p class="text-sm text-gray-600 mb-4">Economia at√© dezembro (m√©dia atual)</p>
                        <div class="space-y-2 text-xs text-gray-500">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-blue-500 mr-2"></i>
                                <span>Padr√£o atual de gastos</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-blue-500 mr-2"></i>
                                <span>Receita mantida</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-blue-500 mr-2"></i>
                                <span>Sem grandes mudan√ßas</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-green-50 border-2 border-green-200 rounded-xl p-6">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-rocket text-green-500 text-2xl mr-3"></i>
                            <h3 class="text-lg font-bold text-green-700">Cen√°rio Otimista</h3>
                        </div>
                        <p class="text-3xl font-bold text-green-600 mb-3" id="cenarioOtimista">R$ 0,00</p>
                        <p class="text-sm text-gray-600 mb-4">Economia at√© dezembro (130% da m√©dia atual)</p>
                        <div class="space-y-2 text-xs text-gray-500">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                <span>Aumento de receita +15%</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                <span>Redu√ß√£o de gastos -10%</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                <span>Rendimento investimentos</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- An√°lise e Recomenda√ß√µes -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-lightbulb mr-2 text-yellow-500"></i>
                            An√°lise Inteligente
                        </h3>
                        <div id="analiseInteligente" class="space-y-3 text-sm text-gray-600">
                            <!-- An√°lise ser√° gerada automaticamente -->
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-6 shadow-lg">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-target mr-2 text-purple-500"></i>
                            Metas Sugeridas
                        </h3>
                        <div id="metasSugeridas" class="space-y-3 text-sm text-gray-600">
                            <!-- Metas ser√£o geradas automaticamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="confirmModal"
        class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md fade-in">
            <div class="flex items-center mb-4">
                <i id="confirmIcon" class="fas fa-question-circle text-3xl text-blue-500 mr-3"></i>
                <h3 id="confirmTitle" class="text-lg font-semibold">Confirmar A√ß√£o</h3>
            </div>
            <p id="confirmMessage" class="text-gray-600 mb-6">Deseja realmente executar esta a√ß√£o?</p>
            <div class="flex space-x-3">
                <button onclick="closeConfirmModal()"
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                    Cancelar
                </button>
                <button id="confirmButton"
                    class="flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                    Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Edi√ß√£o -->
    <div id="editModal"
        class="fixed inset-0 bg-black bg-opacity-50 modal hidden flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md fade-in">
            <div class="flex items-center justify-between mb-4">
                <h3 id="editTitle" class="text-lg font-semibold">Editar Item</h3>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form id="editForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold mb-2 text-gray-700">Descri√ß√£o</label>
                    <input id="editDescricao" type="text" required maxlength="100"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2 text-gray-700">Valor</label>
                    <input id="editValor" type="text" required
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        oninput="formatCurrency(this)">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2 text-gray-700">Categoria</label>
                    <select id="editCategoria" required
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <!-- Op√ß√µes ser√£o preenchidas dinamicamente -->
                    </select>
                </div>
                <div id="editDataContainer">
                    <label class="block text-sm font-semibold mb-2 text-gray-700">Data</label>
                    <input id="editData" type="date" required
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="flex space-x-3">
                    <button type="button" onclick="closeEditModal()"
                        class="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                        Cancelar
                    </button>
                    <button type="submit"
                        class="flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast de Notifica√ß√£o Corrigido -->
    <div id="toast" class="toast-container">
        <div class="bg-white border-l-4 border-green-500 rounded-lg shadow-lg p-4 flex items-center space-x-3">
            <i id="toastIcon" class="fas fa-check-circle text-green-500"></i>
            <div>
                <p id="toastTitle" class="font-semibold text-gray-800">Sucesso</p>
                <p id="toastMessage" class="text-sm text-gray-600">Opera√ß√£o realizada com sucesso</p>
            </div>
        </div>
    </div>

    <!-- JavaScript Principal - M√≥dulo ES6 Corrigido -->
    <script type="module">
        // ==================== IMPORTS E CONFIGURA√á√ÉO ====================
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import {
            getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc,
            query, orderBy, onSnapshot, serverTimestamp
        } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        // Configura√ß√£o do Firebase a partir do script JSON
        const firebaseConfig = JSON.parse(document.getElementById('firebase-config').textContent);

        // Inicializa√ß√£o do Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // ==================== VARI√ÅVEIS GLOBAIS ====================
        let currentUser = null;
        let transacoes = [];
        let patrimonio = [];
        let unsubscribeTransacoes = null;
        let unsubscribePatrimonio = null;

        // Charts
        let evolucaoChart, categoriaChart, projecaoChart;

        // ==================== HELPERS APRIMORADOS ====================

        /**
         * Sanitiza string removendo caracteres especiais
         * @param {string} str - String a ser sanitizada
         * @returns {string} - String sanitizada
         */
        function sanitizeString(str) {
            if (!str) return '';
            return str.toString().trim()
                .replace(/<[^>]*>/g, '') // Remove tags HTML
                .replace(/[^\w\s\-\.√°√©√≠√≥√∫√†√®√¨√≤√π√¢√™√Æ√¥√ª√£√µ√ß]/gi, ''); // Remove caracteres especiais
        }

        /**
         * Valida se uma data est√° dentro do intervalo aceit√°vel
         * @param {string} dateStr - Data em formato YYYY-MM-DD
         * @returns {boolean} - True se v√°lida
         */
        function isValidDate(dateStr) {
            if (!dateStr) return false;

            const date = new Date(dateStr);
            const now = new Date();
            const minDate = new Date('1900-01-01');
            const maxDate = new Date();
            maxDate.setFullYear(maxDate.getFullYear() + 10); // 10 anos no futuro

            return date >= minDate && date <= maxDate && !isNaN(date);
        }

        /**
         * Converte string em formato brasileiro para n√∫mero com valida√ß√£o robusta
         * @param {string} value - Valor em formato "1.234,56"
         * @returns {number} - N√∫mero convertido ou NaN se inv√°lido
         */
        function parseBRL(value) {
            if (!value) return 0;

            // Remove espa√ßos e caracteres n√£o num√©ricos exceto ponto, v√≠rgula e sinal negativo
            const cleanValue = value.toString()
                .replace(/[^\d.,-]/g, '')
                .replace(/\.(?=.*\.)/g, '') // Remove pontos extras (exceto o √∫ltimo)
                .replace(/\./g, '')
                .replace(',', '.');

            const num = Number(cleanValue);

            // Valida√ß√µes adicionais
            if (!isFinite(num) || isNaN(num)) return NaN;
            if (num < 0 || num > 999999999999) return NaN; // Limite m√°ximo

            return num;
        }

        /**
         * Formata n√∫mero para exibi√ß√£o em Real brasileiro
         * @param {number} value - Valor num√©rico
         * @returns {string} - Valor formatado como "R$ 1.234,56"
         */
        function formatBRL(value) {
            if (!value && value !== 0) return 'R$ 0,00';

            try {
                return value.toLocaleString('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                });
            } catch (error) {
                console.error('Erro na formata√ß√£o:', error);
                return 'R$ 0,00';
            }
        }

        /**
         * Formata entrada de moeda em tempo real com valida√ß√£o aprimorada
         * @param {HTMLElement} input - Campo de entrada
         */
        function formatCurrency(input) {
            let value = input.value.replace(/\D/g, '');

            // Remove classe de erro se existir
            input.classList.remove('input-error');

            if (value.length === 0) {
                input.value = '';
                return;
            }

            // Verifica limite m√°ximo definido no data attribute
            const maxValue = parseInt(input.dataset.max) || 999999999;
            const numValue = parseInt(value);

            if (numValue > maxValue) {
                input.classList.add('input-error');
                showFieldError(input, `Valor m√°ximo permitido: ${formatBRL(maxValue / 100)}`);
                return;
            }

            // Adiciona zeros √† esquerda se necess√°rio
            while (value.length < 3) {
                value = '0' + value;
            }

            // Insere v√≠rgula antes dos dois √∫ltimos d√≠gitos
            const formatted = value.slice(0, -2) + ',' + value.slice(-2);

            // Adiciona pontos de milhares
            const parts = formatted.split(',');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');

            input.value = parts.join(',');

            // Adiciona classe de sucesso se valor v√°lido
            const parsedValue = parseBRL(input.value);
            if (!isNaN(parsedValue) && parsedValue > 0) {
                input.classList.add('input-success');
                hideFieldError(input);
            }
        }

        /**
         * Exibe erro espec√≠fico de campo
         * @param {HTMLElement} field - Campo com erro
         * @param {string} message - Mensagem de erro
         */
        function showFieldError(field, message) {
            const errorId = field.id + '-error';
            const errorEl = document.getElementById(errorId);

            if (errorEl) {
                errorEl.textContent = message;
                errorEl.classList.remove('hidden');
            }

            field.classList.add('input-error');
        }

        /**
         * Esconde erro de campo
         * @param {HTMLElement} field - Campo
         */
        function hideFieldError(field) {
            const errorId = field.id + '-error';
            const errorEl = document.getElementById(errorId);

            if (errorEl) {
                errorEl.classList.add('hidden');
            }

            field.classList.remove('input-error');
        }

        /**
         * Exibe toast de notifica√ß√£o com corre√ß√µes
         * @param {string} title - T√≠tulo da notifica√ß√£o
         * @param {string} message - Mensagem da notifica√ß√£o
         * @param {string} type - Tipo: 'success', 'error', 'warning', 'info'
         */
        function showToast(title, message, type = 'success') {
            const toast = document.getElementById('toast');
            const icon = document.getElementById('toastIcon');
            const titleEl = document.getElementById('toastTitle');
            const messageEl = document.getElementById('toastMessage');

            const configs = {
                success: {
                    icon: 'fas fa-check-circle text-green-500',
                    border: 'border-green-500'
                },
                error: {
                    icon: 'fas fa-exclamation-circle text-red-500',
                    border: 'border-red-500'
                },
                warning: {
                    icon: 'fas fa-exclamation-triangle text-yellow-500',
                    border: 'border-yellow-500'
                },
                info: {
                    icon: 'fas fa-info-circle text-blue-500',
                    border: 'border-blue-500'
                }
            };

            const config = configs[type] || configs.success;

            icon.className = config.icon;
            toast.firstElementChild.className = `bg-white border-l-4 ${config.border} rounded-lg shadow-lg p-4 flex items-center space-x-3`;
            titleEl.textContent = title;
            messageEl.textContent = message;

            // Mostrar toast
            toast.classList.add('show');

            // Esconder ap√≥s 4 segundos
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }

        /**
         * Define data atual nos campos de data com valida√ß√£o
         */
        function setToday() {
            const today = new Date().toISOString().split('T')[0];

            const receitaData = document.getElementById('receita-data');
            const despesaData = document.getElementById('despesa-data');

            if (receitaData) receitaData.value = today;
            if (despesaData) despesaData.value = today;
        }

        /**
         * Valida formul√°rio completo
         * @param {HTMLFormElement} form - Formul√°rio a ser validado
         * @param {string} type - Tipo: 'receita', 'despesa', 'patrimonio'
         * @returns {Object|null} - Dados validados ou null se inv√°lido
         */
        function validateForm(form, type) {
            let isValid = true;
            const errors = {};

            // Validar descri√ß√£o
            const descricao = sanitizeString(form.descricao.value);
            if (!descricao || descricao.length < 3) {
                errors.descricao = 'Descri√ß√£o deve ter pelo menos 3 caracteres';
                isValid = false;
            } else if (descricao.length > 100) {
                errors.descricao = 'Descri√ß√£o muito longa (m√°x. 100 caracteres)';
                isValid = false;
            }

            // Validar valor
            const valor = parseBRL(form.valor.value);
            if (isNaN(valor) || valor <= 0) {
                errors.valor = 'Valor deve ser maior que zero';
                isValid = false;
            } else if (valor > 999999999) {
                errors.valor = 'Valor muito alto (m√°x. R$ 999.999.999,00)';
                isValid = false;
            }

            // Validar categoria
            const categoriaValida = ['Sal√°rio', 'Freelancer', 'Investimentos', 'Vendas', 'Aluguel', 'Bonus', 'Outros',
                'Habita√ß√£o', 'Alimenta√ß√£o', 'Transporte', 'Lazer', 'Sa√∫de', 'Educa√ß√£o', 'Roupas',
                'Tecnologia', 'Contas', 'Im√≥vel', 'Ve√≠culo', 'Poupan√ßa', 'Financiamento',
                'Cart√£o de Cr√©dito', 'Empr√©stimo'];

            if (!categoriaValida.includes(form.categoria.value)) {
                errors.categoria = 'Categoria inv√°lida';
                isValid = false;
            }

            // Validar data (apenas para transa√ß√µes)
            if (type !== 'patrimonio') {
                if (!isValidDate(form.data.value)) {
                    errors.data = 'Data inv√°lida';
                    isValid = false;
                }
            }

            // Validar tipo (apenas para patrim√¥nio)
            if (type === 'patrimonio') {
                if (!['bem', 'divida'].includes(form.tipo.value)) {
                    errors.tipo = 'Tipo inv√°lido';
                    isValid = false;
                }
            }

            // Mostrar erros
            Object.keys(errors).forEach(field => {
                const input = form[field];
                if (input) {
                    showFieldError(input, errors[field]);
                }
            });

            if (!isValid) {
                showToast('Erro de Valida√ß√£o', 'Por favor, corrija os erros no formul√°rio', 'error');
                return null;
            }

            // Retornar dados validados
            const data = {
                descricao: descricao,
                valor: valor,
                categoria: form.categoria.value
            };

            if (type !== 'patrimonio') {
                data.tipo = type;
                data.data = form.data.value;
            } else {
                data.tipo = form.tipo.value;
            }

            return data;
        }

        // ==================== AUTENTICA√á√ÉO ====================

        /**
         * Faz login com Google com tratamento de erro aprimorado
         */
        async function loginWithGoogle() {
            const loginBtn = document.getElementById('loginBtn');

            try {
                loginBtn.classList.add('loading');
                loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Conectando...';

                const result = await signInWithPopup(auth, provider);
                currentUser = result.user;

                showToast('Sucesso', 'Login realizado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro no login:', error);

                let errorMessage = 'Falha ao fazer login. Tente novamente.';

                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = 'Login cancelado pelo usu√°rio';
                } else if (error.code === 'auth/popup-blocked') {
                    errorMessage = 'Pop-up bloqueado. Permita pop-ups para este site';
                } else if (error.code === 'auth/cancelled-popup-request') {
                    errorMessage = 'Solicita√ß√£o cancelada';
                }

                showToast('Erro', errorMessage, 'error');
            } finally {
                loginBtn.classList.remove('loading');
                loginBtn.innerHTML = '<i class="fab fa-google mr-2"></i>Entrar com Google';
            }
        }

        /**
         * Faz logout do usu√°rio
         */
        async function logout() {
            try {
                await signOut(auth);
                showToast('Sucesso', 'Logout realizado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro no logout:', error);
                showToast('Erro', 'Erro ao fazer logout', 'error');
            }
        }

        /**
         * Monitora mudan√ßas no estado de autentica√ß√£o
         */
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                showApp();
                initializeUserData();
            } else {
                currentUser = null;
                showLogin();
                cleanupListeners();
            }
        });

        /**
         * Mostra tela de login
         */
        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('appScreen').classList.add('hidden');
        }

        /**
         * Mostra tela principal do app
         */
        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');

            // Atualiza informa√ß√µes do usu√°rio
            document.getElementById('userName').textContent = currentUser.displayName;
            document.getElementById('userPhoto').src = currentUser.photoURL ||
                'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTYiIGZpbGw9IiM2MzY2RjEiLz4KPHRleHQgeD0iNTAlIiB5PSI1MCUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IndoaXRlIiBkeT0iLjNlbSIgZm9udC1zaXplPSIxNCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiPjw/dGV4dD4KPC9zdmc+';

            // Define data atual nos formul√°rios
            setToday();

            // Carrega tab salva ou dashboard
            const savedTab = localStorage.getItem('currentTab') || 'dashboard';
            showTab(savedTab);
        }

        // ==================== FIRESTORE OPERATIONS COM TRATAMENTO DE ERRO ====================

        /**
         * Inicializa dados do usu√°rio com listeners em tempo real
         */
        function initializeUserData() {
            if (!currentUser) return;

            try {
                setupTransacoesListener();
                setupPatrimonioListener();
                initCharts();
            } catch (error) {
                console.error('Erro na inicializa√ß√£o:', error);
                showToast('Erro', 'Erro ao carregar dados do usu√°rio', 'error');
            }
        }

        /**
         * Configura listener para transa√ß√µes em tempo real
         */
        function setupTransacoesListener() {
            if (unsubscribeTransacoes) unsubscribeTransacoes();

            try {
                const q = query(
                    collection(db, 'users', currentUser.uid, 'transacoes'),
                    orderBy('createdAt', 'desc')
                );

                unsubscribeTransacoes = onSnapshot(q, (snapshot) => {
                    transacoes = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        // Validar dados antes de adicionar
                        if (data.valor && data.descricao && data.categoria) {
                            transacoes.push({ id: doc.id, ...data });
                        }
                    });

                    renderTransacoes();
                    updateDashboard();
                    updateCharts();
                }, (error) => {
                    console.error('Erro ao carregar transa√ß√µes:', error);
                    showToast('Erro', 'Erro ao carregar transa√ß√µes. Verifique sua conex√£o.', 'error');
                });
            } catch (error) {
                console.error('Erro no listener de transa√ß√µes:', error);
                showToast('Erro', 'Erro na configura√ß√£o do sincronismo', 'error');
            }
        }

        /**
         * Configura listener para patrim√¥nio em tempo real
         */
        function setupPatrimonioListener() {
            if (unsubscribePatrimonio) unsubscribePatrimonio();

            try {
                const q = query(collection(db, 'users', currentUser.uid, 'patrimonio'));

                unsubscribePatrimonio = onSnapshot(q, (snapshot) => {
                    patrimonio = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        // Validar dados antes de adicionar
                        if (data.valor && data.descricao && data.categoria && data.tipo) {
                            patrimonio.push({ id: doc.id, ...data });
                        }
                    });

                    renderPatrimonio();
                }, (error) => {
                    console.error('Erro ao carregar patrim√¥nio:', error);
                    showToast('Erro', 'Erro ao carregar patrim√¥nio. Verifique sua conex√£o.', 'error');
                });
            } catch (error) {
                console.error('Erro no listener de patrim√¥nio:', error);
                showToast('Erro', 'Erro na configura√ß√£o do sincronismo', 'error');
            }
        }

        /**
         * Remove listeners ativos
         */
        function cleanupListeners() {
            try {
                if (unsubscribeTransacoes) {
                    unsubscribeTransacoes();
                    unsubscribeTransacoes = null;
                }
                if (unsubscribePatrimonio) {
                    unsubscribePatrimonio();
                    unsubscribePatrimonio = null;
                }
            } catch (error) {
                console.error('Erro ao limpar listeners:', error);
            }
        }

        /**
         * Adiciona nova transa√ß√£o com valida√ß√£o e tratamento de erro
         * @param {Object} data - Dados da transa√ß√£o
         */
        async function addTransaction(data) {
            try {
                if (!currentUser) {
                    throw new Error('Usu√°rio n√£o autenticado');
                }

                await addDoc(collection(db, 'users', currentUser.uid, 'transacoes'), {
                    ...data,
                    createdAt: serverTimestamp()
                });

                showToast('Sucesso', `${data.tipo === 'receita' ? 'Receita' : 'Despesa'} adicionada com sucesso!`, 'success');
            } catch (error) {
                console.error('Erro ao salvar transa√ß√£o:', error);

                let errorMessage = 'Erro ao salvar transa√ß√£o';
                if (error.code === 'permission-denied') {
                    errorMessage = 'Permiss√£o negada. Verifique suas credenciais.';
                } else if (error.code === 'unavailable') {
                    errorMessage = 'Servi√ßo indispon√≠vel. Tente novamente.';
                }

                showToast('Erro', errorMessage, 'error');
                throw error;
            }
        }

        /**
         * Adiciona novo item de patrim√¥nio
         * @param {Object} data - Dados do patrim√¥nio
         */
        async function addPatrimony(data) {
            try {
                if (!currentUser) {
                    throw new Error('Usu√°rio n√£o autenticado');
                }

                await addDoc(collection(db, 'users', currentUser.uid, 'patrimonio'), {
                    ...data,
                    createdAt: serverTimestamp()
                });

                showToast('Sucesso', `${data.tipo === 'bem' ? 'Bem' : 'D√≠vida'} adicionado(a) com sucesso!`, 'success');
            } catch (error) {
                console.error('Erro ao salvar patrim√¥nio:', error);

                let errorMessage = 'Erro ao salvar patrim√¥nio';
                if (error.code === 'permission-denied') {
                    errorMessage = 'Permiss√£o negada. Verifique suas credenciais.';
                }

                showToast('Erro', errorMessage, 'error');
                throw error;
            }
        }

        /**
         * Atualiza item existente
         * @param {string} collectionName - Cole√ß√£o do item
         * @param {string} id - ID do item
         * @param {Object} data - Novos dados
         */
        async function updateItem(collectionName, id, data) {
            try {
                if (!currentUser || !id) {
                    throw new Error('Dados inv√°lidos para atualiza√ß√£o');
                }

                const docRef = doc(db, 'users', currentUser.uid, collectionName, id);
                await updateDoc(docRef, data);

                showToast('Sucesso', 'Item atualizado com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao atualizar:', error);
                showToast('Erro', 'Erro ao atualizar item', 'error');
                throw error;
            }
        }

        /**
         * Deleta item
         * @param {string} collectionName - Cole√ß√£o do item
         * @param {string} id - ID do item
         */
        async function deleteItem(collectionName, id) {
            try {
                if (!currentUser || !id) {
                    throw new Error('Dados inv√°lidos para exclus√£o');
                }

                await deleteDoc(doc(db, 'users', currentUser.uid, collectionName, id));
                showToast('Sucesso', 'Item removido com sucesso!', 'success');
            } catch (error) {
                console.error('Erro ao excluir:', error);
                showToast('Erro', 'Erro ao excluir item', 'error');
                throw error;
            }
        }

        // ==================== UI RENDERING ====================

        /**
         * Renderiza lista de transa√ß√µes
         */
        function renderTransacoes() {
            const tbody = document.getElementById('transacoesTableBody');
            const totalEl = document.getElementById('totalTransacoes');
            const receitasList = document.getElementById('receitasList');
            const despesasList = document.getElementById('despesasList');

            if (!tbody || !totalEl || !receitasList || !despesasList) return;

            tbody.innerHTML = '';
            receitasList.innerHTML = '';
            despesasList.innerHTML = '';

            totalEl.textContent = `${transacoes.length} transa√ß√µes`;

            try {
                // Renderiza √∫ltimas 10 transa√ß√µes na tabela
                transacoes.slice(0, 10).forEach(transacao => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50 transition-colors';

                    const data = new Date(transacao.data).toLocaleDateString('pt-BR');
                    const valor = formatBRL(transacao.valor);
                    const tipo = transacao.tipo;
                    const corValor = tipo === 'receita' ? 'text-green-600' : 'text-red-600';
                    const icone = tipo === 'receita' ? 'fa-arrow-up' : 'fa-arrow-down';
                    const emoji = tipo === 'receita' ? 'üí∞' : 'üí∏';

                    row.innerHTML = `
                        <td class="px-4 py-3">${data}</td>
                        <td class="px-4 py-3">
                            <div class="flex items-center">
                                <span class="mr-2">${emoji}</span>
                                <span class="font-medium">${sanitizeString(transacao.descricao)}</span>
                            </div>
                        </td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 bg-gray-100 rounded-full text-xs">${sanitizeString(transacao.categoria)}</span>
                        </td>
                        <td class="px-4 py-3 ${corValor} font-semibold text-right">
                            <i class="fas ${icone} mr-1"></i>${valor}
                        </td>
                        <td class="px-4 py-3 text-center">
                            <button onclick="editTransaction('${transacao.id}')" 
                                    class="text-blue-500 hover:text-blue-700 mr-2" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTransactionConfirm('${transacao.id}')" 
                                    class="text-red-500 hover:text-red-700" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                // Renderiza listas espec√≠ficas por tipo
                const receitas = transacoes.filter(t => t.tipo === 'receita').slice(0, 5);
                const despesas = transacoes.filter(t => t.tipo === 'despesa').slice(0, 5);

                receitas.forEach(receita => {
                    const item = createTransactionListItem(receita, 'green');
                    receitasList.appendChild(item);
                });

                despesas.forEach(despesa => {
                    const item = createTransactionListItem(despesa, 'red');
                    despesasList.appendChild(item);
                });

                // Mensagem se n√£o h√° transa√ß√µes
                if (receitas.length === 0) {
                    receitasList.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhuma receita registrada</p>';
                }

                if (despesas.length === 0) {
                    despesasList.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhuma despesa registrada</p>';
                }
            } catch (error) {
                console.error('Erro ao renderizar transa√ß√µes:', error);
                showToast('Erro', 'Erro ao exibir transa√ß√µes', 'error');
            }
        }

        /**
         * Cria item da lista de transa√ß√µes
         * @param {Object} transacao - Dados da transa√ß√£o
         * @param {string} color - Cor do item
         */
        function createTransactionListItem(transacao, color) {
            const item = document.createElement('div');
            item.className = `flex items-center justify-between p-3 bg-${color}-50 border border-${color}-100 rounded-lg hover:bg-${color}-100 transition-colors`;

            try {
                const data = new Date(transacao.data).toLocaleDateString('pt-BR');
                const valor = formatBRL(transacao.valor);
                const emoji = transacao.tipo === 'receita' ? 'üí∞' : 'üí∏';

                item.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-lg">${emoji}</span>
                        <div>
                            <p class="font-medium text-gray-800">${sanitizeString(transacao.descricao)}</p>
                            <p class="text-xs text-gray-600">${sanitizeString(transacao.categoria)} ‚Ä¢ ${data}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-${color}-700">${valor}</p>
                        <div class="space-x-1">
                            <button onclick="editTransaction('${transacao.id}')" 
                                    class="text-blue-500 hover:text-blue-700 text-xs" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTransactionConfirm('${transacao.id}')" 
                                    class="text-red-500 hover:text-red-700 text-xs" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Erro ao criar item de transa√ß√£o:', error);
                item.innerHTML = '<p class="text-red-500">Erro ao carregar item</p>';
            }

            return item;
        }

        /**
         * Renderiza patrim√¥nio
         */
        function renderPatrimonio() {
            const bensContainer = document.getElementById('bensList');
            const dividasContainer = document.getElementById('dividasList');

            if (!bensContainer || !dividasContainer) return;

            bensContainer.innerHTML = '';
            dividasContainer.innerHTML = '';

            let totalBens = 0;
            let totalDividas = 0;
            let quantidadeBens = 0;
            let quantidadeDividas = 0;

            try {
                patrimonio.forEach(item => {
                    const valor = formatBRL(item.valor);

                    if (item.tipo === 'bem') {
                        totalBens += item.valor;
                        quantidadeBens++;
                        const element = createPatrimonioItem(item, valor, 'green', 'üíé');
                        bensContainer.appendChild(element);
                    } else {
                        totalDividas += item.valor;
                        quantidadeDividas++;
                        const element = createPatrimonioItem(item, valor, 'red', 'üí≥');
                        dividasContainer.appendChild(element);
                    }
                });

                // Mensagens se n√£o h√° itens
                if (quantidadeBens === 0) {
                    bensContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhum bem cadastrado</p>';
                }

                if (quantidadeDividas === 0) {
                    dividasContainer.innerHTML = '<p class="text-gray-500 text-center py-4">Nenhuma d√≠vida cadastrada</p>';
                }

                // Atualiza resumo do patrim√¥nio
                document.getElementById('totalBens').textContent = formatBRL(totalBens);
                document.getElementById('totalDividas').textContent = formatBRL(totalDividas);
                document.getElementById('patrimonioLiquido').textContent = formatBRL(totalBens - totalDividas);
                document.getElementById('quantidadeBens').textContent = `${quantidadeBens} itens`;
                document.getElementById('quantidadeDividas').textContent = `${quantidadeDividas} itens`;

                const patrimonioLiquido = totalBens - totalDividas;
                const statusEl = document.getElementById('statusPatrimonio');
                statusEl.textContent = patrimonioLiquido >= 0 ? 'Positivo' : 'Negativo';
                statusEl.className = patrimonioLiquido >= 0 ? 'text-xs opacity-75 mt-1' : 'text-xs opacity-75 mt-1 text-red-200';
            } catch (error) {
                console.error('Erro ao renderizar patrim√¥nio:', error);
                showToast('Erro', 'Erro ao exibir patrim√¥nio', 'error');
            }
        }

        /**
         * Cria item de patrim√¥nio
         * @param {Object} item - Dados do item
         * @param {string} valor - Valor formatado
         * @param {string} color - Cor do item
         * @param {string} emoji - Emoji do item
         */
        function createPatrimonioItem(item, valor, color, emoji) {
            const element = document.createElement('div');
            element.className = `flex items-center justify-between p-3 bg-${color}-50 border border-${color}-100 rounded-lg hover:bg-${color}-100 transition-colors`;

            try {
                element.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="text-lg">${emoji}</span>
                        <div>
                            <p class="font-medium text-gray-800">${sanitizeString(item.descricao)}</p>
                            <p class="text-xs text-gray-600">${sanitizeString(item.categoria)}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-${color}-700">${valor}</p>
                        <div class="space-x-1">
                            <button onclick="editPatrimonio('${item.id}')" 
                                    class="text-blue-500 hover:text-blue-700 text-xs" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deletePatrimonioConfirm('${item.id}')" 
                                    class="text-red-500 hover:text-red-700 text-xs" title="Excluir">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Erro ao criar item de patrim√¥nio:', error);
                element.innerHTML = '<p class="text-red-500">Erro ao carregar item</p>';
            }

            return element;
        }

        // ==================== DASHBOARD E C√ÅLCULOS ====================

        /**
         * Atualiza dashboard principal
         */
        function updateDashboard() {
            try {
                const agora = new Date();
                const inicioMes = new Date(agora.getFullYear(), agora.getMonth(), 1);
                const fimMes = new Date(agora.getFullYear(), agora.getMonth() + 1, 0);

                // Filtra transa√ß√µes do m√™s atual
                const transacoesMes = transacoes.filter(t => {
                    if (!t.data) return false;
                    const dataTransacao = new Date(t.data);
                    return dataTransacao >= inicioMes && dataTransacao <= fimMes;
                });

                const receitas = transacoesMes.filter(t => t.tipo === 'receita');
                const despesas = transacoesMes.filter(t => t.tipo === 'despesa');

                const totalReceitas = receitas.reduce((sum, t) => sum + (t.valor || 0), 0);
                const totalDespesas = despesas.reduce((sum, t) => sum + (t.valor || 0), 0);
                const saldoAtual = totalReceitas - totalDespesas;
                const economiaMensal = saldoAtual;

                // Calcula m√©dias anuais
                const receitasAnuais = transacoes.filter(t => t.tipo === 'receita');
                const despesasAnuais = transacoes.filter(t => t.tipo === 'despesa');

                const mediaReceitas = receitasAnuais.length > 0 ?
                    receitasAnuais.reduce((sum, t) => sum + (t.valor || 0), 0) / 12 : 0;
                const mediaDespesas = despesasAnuais.length > 0 ?
                    despesasAnuais.reduce((sum, t) => sum + (t.valor || 0), 0) / 12 : 0;

                // Atualiza elementos do dashboard
                document.getElementById('saldoAtual').textContent = formatBRL(saldoAtual);
                document.getElementById('receitasMes').textContent = formatBRL(totalReceitas);
                document.getElementById('despesasMes').textContent = formatBRL(totalDespesas);
                document.getElementById('economiaMensal').textContent = formatBRL(economiaMensal);

                // Atualiza m√©dias
                document.getElementById('mediaReceitas').textContent = `M√©dia: ${formatBRL(mediaReceitas)}`;
                document.getElementById('mediaDespesas').textContent = `M√©dia: ${formatBRL(mediaDespesas)}`;

                // Atualiza resumos espec√≠ficos
                document.getElementById('totalReceitasMes').textContent = formatBRL(totalReceitas);
                document.getElementById('totalDespesasMes').textContent = formatBRL(totalDespesas);
                document.getElementById('mediaReceitasMensal').textContent = formatBRL(mediaReceitas);
                document.getElementById('mediaDespesasMensal').textContent = formatBRL(mediaDespesas);

                // Calcula percentuais
                const percentualEconomia = totalReceitas > 0 ? (economiaMensal / totalReceitas * 100) : 0;
                document.getElementById('percentualEconomia').textContent = `${percentualEconomia.toFixed(1)}% da receita`;

                // Chama c√°lculos de proje√ß√£o
                updateProjecaoCalculations();
            } catch (error) {
                console.error('Erro ao atualizar dashboard:', error);
                showToast('Erro', 'Erro ao atualizar dashboard', 'error');
            }
        }

        /**
         * Atualiza c√°lculos de proje√ß√£o anual
         */
        function updateProjecaoCalculations() {
            try {
                const agora = new Date();
                const mesesRestantes = 12 - agora.getMonth();

                // Calcula economia mensal m√©dia baseada no hist√≥rico
                const receitaTotal = transacoes
                    .filter(t => t.tipo === 'receita' && new Date(t.data).getFullYear() === agora.getFullYear())
                    .reduce((sum, t) => sum + (t.valor || 0), 0);

                const despesaTotal = transacoes
                    .filter(t => t.tipo === 'despesa' && new Date(t.data).getFullYear() === agora.getFullYear())
                    .reduce((sum, t) => sum + (t.valor || 0), 0);

                const mesesDecorridos = agora.getMonth() + 1;
                const economiaMensalMedia = mesesDecorridos > 0 ?
                    (receitaTotal - despesaTotal) / mesesDecorridos : 0;

                // Calcula cen√°rios
                const conservador = economiaMensalMedia * 0.7 * mesesRestantes;
                const realista = economiaMensalMedia * mesesRestantes;
                const otimista = economiaMensalMedia * 1.3 * mesesRestantes;

                // Atualiza elementos
                document.getElementById('cenarioConservador').textContent = formatBRL(conservador);
                document.getElementById('cenarioRealista').textContent = formatBRL(realista);
                document.getElementById('cenarioOtimista').textContent = formatBRL(otimista);

                // Gera an√°lise inteligente
                generateAnaliseInteligente(economiaMensalMedia, receitaTotal, despesaTotal);

                // Gera metas sugeridas
                generateMetasSugeridas(economiaMensalMedia);
            } catch (error) {
                console.error('Erro nos c√°lculos de proje√ß√£o:', error);
            }
        }

        /**
         * Gera an√°lise inteligente autom√°tica
         * @param {number} economiaMensal - Economia mensal m√©dia
         * @param {number} receitas - Total de receitas
         * @param {number} despesas - Total de despesas
         */
        function generateAnaliseInteligente(economiaMensal, receitas, despesas) {
            const container = document.getElementById('analiseInteligente');
            if (!container) return;

            try {
                const analyses = [];

                // An√°lise de economia
                if (economiaMensal > 0) {
                    const percentual = receitas > 0 ? (economiaMensal / (receitas / 12) * 100) : 0;
                    analyses.push(`
                        <div class="flex items-start space-x-2">
                            <i class="fas fa-thumbs-up text-green-500 mt-1"></i>
                            <p>Voc√™ tem uma economia mensal positiva de <strong>${formatBRL(economiaMensal)}</strong> (${percentual.toFixed(1)}% da receita).</p>
                        </div>
                    `);
                } else {
                    analyses.push(`
                        <div class="flex items-start space-x-2">
                            <i class="fas fa-exclamation-triangle text-yellow-500 mt-1"></i>
                            <p>Suas despesas est√£o superando as receitas em <strong>${formatBRL(Math.abs(economiaMensal))}</strong> por m√™s.</p>
                        </div>
                    `);
                }

                // An√°lise de categorias
                const despesasPorCategoria = {};
                transacoes
                    .filter(t => t.tipo === 'despesa')
                    .forEach(t => {
                        if (t.categoria && t.valor) {
                            despesasPorCategoria[t.categoria] = (despesasPorCategoria[t.categoria] || 0) + t.valor;
                        }
                    });

                const categoriasMaiorGasto = Object.entries(despesasPorCategoria)
                    .sort(([, a], [, b]) => b - a)
                    .slice(0, 2);

                if (categoriasMaiorGasto.length > 0) {
                    analyses.push(`
                        <div class="flex items-start space-x-2">
                            <i class="fas fa-chart-pie text-blue-500 mt-1"></i>
                            <p>Suas maiores despesas est√£o em <strong>${categoriasMaiorGasto[0][0]}</strong> (${formatBRL(categoriasMaiorGasto[0][1])}).</p>
                        </div>
                    `);
                }

                container.innerHTML = analyses.join('');
            } catch (error) {
                console.error('Erro na an√°lise inteligente:', error);
                container.innerHTML = '<p class="text-red-500">Erro ao gerar an√°lise</p>';
            }
        }

        /**
         * Gera metas sugeridas automaticamente
         * @param {number} economiaMensal - Economia mensal m√©dia
         */
        function generateMetasSugeridas(economiaMensal) {
            const container = document.getElementById('metasSugeridas');
            if (!container) return;

            try {
                const metas = [];

                if (economiaMensal > 0) {
                    const metaEmergencia = economiaMensal * 6;
                    metas.push(`
                        <div class="flex items-start space-x-2">
                            <i class="fas fa-piggy-bank text-green-500 mt-1"></i>
                            <p>Reserve <strong>${formatBRL(metaEmergencia)}</strong> como fundo de emerg√™ncia (6 meses de economia).</p>
                        </div>
                    `);

                    const metaInvestimento = economiaMensal * 0.3;
                    metas.push(`
                        <div class="flex items-start space-x-2">
                            <i class="fas fa-chart-line text-blue-500 mt-1"></i>
                            <p>Considere investir <strong>${formatBRL(metaInvestimento)}</strong> mensalmente (30% da economia).</p>
                        </div>
                    `);
                } else {
                    metas.push(`
                        <div class="flex items-start space-x-2">
                            <i class="fas fa-cut text-red-500 mt-1"></i>
                            <p>Reduza gastos em <strong>${formatBRL(Math.abs(economiaMensal))}</strong> para equilibrar o or√ßamento.</p>
                        </div>
                    `);
                }

                metas.push(`
                    <div class="flex items-start space-x-2">
                        <i class="fas fa-target text-purple-500 mt-1"></i>
                        <p>Estabele√ßa um or√ßamento mensal e acompanhe semanalmente.</p>
                    </div>
                `);

                container.innerHTML = metas.join('');
            } catch (error) {
                console.error('Erro nas metas sugeridas:', error);
                container.innerHTML = '<p class="text-red-500">Erro ao gerar metas</p>';
            }
        }

        // ==================== GR√ÅFICOS ====================

        /**
         * Inicializa todos os gr√°ficos
         */
        function initCharts() {
            try {
                initEvolucaoChart();
                initCategoriaChart();
                initProjecaoChart();
            } catch (error) {
                console.error('Erro ao inicializar gr√°ficos:', error);
            }
        }

        /**
         * Inicializa gr√°fico de evolu√ß√£o mensal
         */
        function initEvolucaoChart() {
            const ctx = document.getElementById('evolucaoChart');
            if (!ctx) return;

            try {
                evolucaoChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
                            'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                        datasets: [{
                            label: 'Receitas',
                            data: Array(12).fill(0),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Despesas',
                            data: Array(12).fill(0),
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return context.dataset.label + ': ' + formatBRL(context.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function (value) {
                                        return formatBRL(value);
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Erro no gr√°fico de evolu√ß√£o:', error);
            }
        }

        /**
         * Inicializa gr√°fico de categorias
         */
        function initCategoriaChart() {
            const ctx = document.getElementById('categoriaChart');
            if (!ctx) return;

            try {
                categoriaChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: [
                                '#3b82f6', '#ef4444', '#10b981', '#f59e0b',
                                '#8b5cf6', '#ec4899', '#06b6d4', '#84cc16',
                                '#f97316', '#6366f1', '#14b8a6', '#f43f5e'
                            ],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        const label = context.label || '';
                                        const value = formatBRL(context.parsed);
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((context.parsed / total) * 100).toFixed(1);
                                        return `${label}: ${value} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Erro no gr√°fico de categorias:', error);
            }
        }

        /**
         * Inicializa gr√°fico de proje√ß√£o
         */
        function initProjecaoChart() {
            const ctx = document.getElementById('projecaoChart');
            if (!ctx) return;

            try {
                projecaoChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
                            'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                        datasets: [{
                            label: 'Economia Acumulada',
                            data: Array(12).fill(0),
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: '#3b82f6',
                            borderWidth: 2,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function (context) {
                                        return 'Economia: ' + formatBRL(context.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function (value) {
                                        return formatBRL(value);
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Erro no gr√°fico de proje√ß√£o:', error);
            }
        }

        /**
         * Atualiza dados dos gr√°ficos
         */
        function updateCharts() {
            try {
                updateEvolucaoChart();
                updateCategoriaChart();
                updateProjecaoChart();
            } catch (error) {
                console.error('Erro ao atualizar gr√°ficos:', error);
            }
        }

        /**
         * Atualiza gr√°fico de evolu√ß√£o
         */
        function updateEvolucaoChart() {
            if (!evolucaoChart) return;

            try {
                const receitasMeses = Array(12).fill(0);
                const despesasMeses = Array(12).fill(0);

                transacoes.forEach(transacao => {
                    if (transacao.data && transacao.valor) {
                        const data = new Date(transacao.data);
                        const mes = data.getMonth();

                        if (mes >= 0 && mes < 12) {
                            if (transacao.tipo === 'receita') {
                                receitasMeses[mes] += transacao.valor;
                            } else {
                                despesasMeses[mes] += transacao.valor;
                            }
                        }
                    }
                });

                evolucaoChart.data.datasets[0].data = receitasMeses;
                evolucaoChart.data.datasets[1].data = despesasMeses;
                evolucaoChart.update('none');
            } catch (error) {
                console.error('Erro ao atualizar gr√°fico de evolu√ß√£o:', error);
            }
        }

        /**
         * Atualiza gr√°fico de categorias
         */
        function updateCategoriaChart() {
            if (!categoriaChart) return;

            try {
                const categorias = {};

                transacoes
                    .filter(t => t.tipo === 'despesa' && t.categoria && t.valor)
                    .forEach(transacao => {
                        categorias[transacao.categoria] = (categorias[transacao.categoria] || 0) + transacao.valor;
                    });

                categoriaChart.data.labels = Object.keys(categorias);
                categoriaChart.data.datasets[0].data = Object.values(categorias);
                categoriaChart.update('none');
            } catch (error) {
                console.error('Erro ao atualizar gr√°fico de categorias:', error);
            }
        }

        /**
         * Atualiza gr√°fico de proje√ß√£o
         */
        function updateProjecaoChart() {
            if (!projecaoChart) return;

            try {
                const agora = new Date();
                const receitaTotal = transacoes
                    .filter(t => t.tipo === 'receita' && t.data && new Date(t.data).getFullYear() === agora.getFullYear())
                    .reduce((sum, t) => sum + (t.valor || 0), 0);

                const despesaTotal = transacoes
                    .filter(t => t.tipo === 'despesa' && t.data && new Date(t.data).getFullYear() === agora.getFullYear())
                    .reduce((sum, t) => sum + (t.valor || 0), 0);

                const mesesDecorridos = agora.getMonth() + 1;
                const economiaMensalMedia = mesesDecorridos > 0 ?
                    (receitaTotal - despesaTotal) / mesesDecorridos : 0;

                const projecaoMensal = Array(12).fill().map((_, i) =>
                    economiaMensalMedia * (i + 1)
                );

                projecaoChart.data.datasets[0].data = projecaoMensal;
                projecaoChart.update('none');
            } catch (error) {
                console.error('Erro ao atualizar gr√°fico de proje√ß√£o:', error);
            }
        }

        // ==================== FORM HANDLERS CORRIGIDOS ====================

        /**
         * Handler do formul√°rio de receitas com valida√ß√£o aprimorada
         * @param {Event} event - Evento do formul√°rio
         */
        async function handleReceitaForm(event) {
            event.preventDefault();

            const form = event.target;
            const submitBtn = document.getElementById('receitaSubmitBtn');

            try {
                submitBtn.classList.add('loading');
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Salvando...';

                // Validar formul√°rio
                const data = validateForm(form, 'receita');
                if (!data) return;

                await addTransaction(data);

                // Reset form and clear errors
                form.reset();
                form.querySelectorAll('.input-error').forEach(input => {
                    input.classList.remove('input-error', 'input-success');
                    hideFieldError(input);
                });
                setToday();

            } catch (error) {
                console.error('Erro ao salvar receita:', error);
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<i class="fas fa-plus mr-2"></i>Adicionar Receita';
            }
        }

        /**
         * Handler do formul√°rio de despesas com valida√ß√£o aprimorada
         * @param {Event} event - Evento do formul√°rio
         */
        async function handleDespesaForm(event) {
            event.preventDefault();

            const form = event.target;
            const submitBtn = document.getElementById('despesaSubmitBtn');

            try {
                submitBtn.classList.add('loading');
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Salvando...';

                // Validar formul√°rio
                const data = validateForm(form, 'despesa');
                if (!data) return;

                await addTransaction(data);

                // Reset form and clear errors
                form.reset();
                form.querySelectorAll('.input-error').forEach(input => {
                    input.classList.remove('input-error', 'input-success');
                    hideFieldError(input);
                });
                setToday();

            } catch (error) {
                console.error('Erro ao salvar despesa:', error);
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<i class="fas fa-plus mr-2"></i>Adicionar Despesa';
            }
        }

        /**
         * Handler do formul√°rio de patrim√¥nio com valida√ß√£o aprimorada
         * @param {Event} event - Evento do formul√°rio
         */
        async function handlePatrimonioForm(event) {
            event.preventDefault();

            const form = event.target;
            const submitBtn = document.getElementById('patrimonioSubmitBtn');

            try {
                submitBtn.classList.add('loading');
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Salvando...';

                // Validar formul√°rio
                const data = validateForm(form, 'patrimonio');
                if (!data) return;

                await addPatrimony(data);

                // Reset form and clear errors
                form.reset();
                form.querySelectorAll('.input-error').forEach(input => {
                    input.classList.remove('input-error', 'input-success');
                });

            } catch (error) {
                console.error('Erro ao salvar patrim√¥nio:', error);
            } finally {
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = '<i class="fas fa-plus mr-2"></i>Adicionar Item';
            }
        }

        // ==================== MODAL FUNCTIONS ====================

        let currentEditId = null;
        let currentEditCollection = null;

        /**
         * Abre modal de confirma√ß√£o
         * @param {string} title - T√≠tulo do modal
         * @param {string} message - Mensagem do modal
         * @param {Function} callback - Fun√ß√£o a executar se confirmado
         * @param {string} type - Tipo do modal (danger, warning, info)
         */
        function openConfirmModal(title, message, callback, type = 'danger') {
            const modal = document.getElementById('confirmModal');
            const icon = document.getElementById('confirmIcon');
            const titleEl = document.getElementById('confirmTitle');
            const messageEl = document.getElementById('confirmMessage');
            const confirmBtn = document.getElementById('confirmButton');

            const icons = {
                danger: 'fas fa-exclamation-triangle text-red-500',
                warning: 'fas fa-exclamation-triangle text-yellow-500',
                info: 'fas fa-info-circle text-blue-500'
            };

            const btnColors = {
                danger: 'bg-red-500 hover:bg-red-600',
                warning: 'bg-yellow-500 hover:bg-yellow-600',
                info: 'bg-blue-500 hover:bg-blue-600'
            };

            icon.className = icons[type] || icons.danger;
            titleEl.textContent = title;
            messageEl.textContent = message;
            confirmBtn.className = `flex-1 px-4 py-2 text-white rounded-lg transition-colors ${btnColors[type]}`;

            confirmBtn.onclick = () => {
                closeConfirmModal();
                callback();
            };

            modal.classList.remove('hidden');
        }

        /**
         * Fecha modal de confirma√ß√£o
         */
        function closeConfirmModal() {
            const modal = document.getElementById('confirmModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        /**
         * Abre modal de edi√ß√£o para transa√ß√£o com valida√ß√£o
         * @param {string} id - ID da transa√ß√£o
         */
        function editTransaction(id) {
            const transacao = transacoes.find(t => t.id === id);
            if (!transacao) {
                showToast('Erro', 'Transa√ß√£o n√£o encontrada', 'error');
                return;
            }

            try {
                currentEditId = id;
                currentEditCollection = 'transacoes';

                const modal = document.getElementById('editModal');
                const form = document.getElementById('editForm');
                const title = document.getElementById('editTitle');

                title.textContent = `Editar ${transacao.tipo === 'receita' ? 'Receita' : 'Despesa'}`;

                // Preenche campos com sanitiza√ß√£o
                document.getElementById('editDescricao').value = sanitizeString(transacao.descricao);
                document.getElementById('editValor').value = transacao.valor.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).replace('.', ',');
                document.getElementById('editData').value = transacao.data;

                // Preenche categorias
                const categoriaSelect = document.getElementById('editCategoria');
                categoriaSelect.innerHTML = '';

                const categorias = transacao.tipo === 'receita' ?
                    ['Sal√°rio', 'Freelancer', 'Investimentos', 'Vendas', 'Aluguel', 'Bonus', 'Outros'] :
                    ['Habita√ß√£o', 'Alimenta√ß√£o', 'Transporte', 'Lazer', 'Sa√∫de', 'Educa√ß√£o', 'Roupas', 'Tecnologia', 'Contas', 'Outros'];

                categorias.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    option.selected = cat === transacao.categoria;
                    categoriaSelect.appendChild(option);
                });

                // Mostra campo de data
                document.getElementById('editDataContainer').style.display = 'block';

                // Handler do formul√°rio
                form.onsubmit = handleEditSubmit;

                modal.classList.remove('hidden');
            } catch (error) {
                console.error('Erro ao abrir edi√ß√£o:', error);
                showToast('Erro', 'Erro ao abrir formul√°rio de edi√ß√£o', 'error');
            }
        }

        /**
         * Abre modal de edi√ß√£o para patrim√¥nio
         * @param {string} id - ID do patrim√¥nio
         */
        function editPatrimonio(id) {
            const item = patrimonio.find(p => p.id === id);
            if (!item) {
                showToast('Erro', 'Item de patrim√¥nio n√£o encontrado', 'error');
                return;
            }

            try {
                currentEditId = id;
                currentEditCollection = 'patrimonio';

                const modal = document.getElementById('editModal');
                const form = document.getElementById('editForm');
                const title = document.getElementById('editTitle');

                title.textContent = `Editar ${item.tipo === 'bem' ? 'Bem' : 'D√≠vida'}`;

                // Preenche campos com sanitiza√ß√£o
                document.getElementById('editDescricao').value = sanitizeString(item.descricao);
                document.getElementById('editValor').value = item.valor.toLocaleString('pt-BR', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).replace('.', ',');

                // Preenche categorias
                const categoriaSelect = document.getElementById('editCategoria');
                categoriaSelect.innerHTML = '';

                const categorias = ['Im√≥vel', 'Ve√≠culo', 'Investimentos', 'Poupan√ßa', 'Financiamento', 'Cart√£o de Cr√©dito', 'Empr√©stimo', 'Outros'];

                categorias.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    option.selected = cat === item.categoria;
                    categoriaSelect.appendChild(option);
                });

                // Esconde campo de data
                document.getElementById('editDataContainer').style.display = 'none';

                // Handler do formul√°rio
                form.onsubmit = handleEditSubmit;

                modal.classList.remove('hidden');
            } catch (error) {
                console.error('Erro ao abrir edi√ß√£o de patrim√¥nio:', error);
                showToast('Erro', 'Erro ao abrir formul√°rio de edi√ß√£o', 'error');
            }
        }

        /**
         * Handler do formul√°rio de edi√ß√£o com valida√ß√£o aprimorada
         * @param {Event} event - Evento do formul√°rio
         */
        async function handleEditSubmit(event) {
            event.preventDefault();

            const form = event.target;

            try {
                // Valida√ß√£o manual para edi√ß√£o
                const descricao = sanitizeString(form.querySelector('#editDescricao').value);
                const valor = parseBRL(form.querySelector('#editValor').value);
                const categoria = form.querySelector('#editCategoria').value;

                if (!descricao || descricao.length < 3) {
                    showToast('Erro', 'Descri√ß√£o deve ter pelo menos 3 caracteres', 'error');
                    return;
                }

                if (isNaN(valor) || valor <= 0) {
                    showToast('Erro', 'Valor deve ser maior que zero', 'error');
                    return;
                }

                const data = {
                    descricao: descricao,
                    valor: valor,
                    categoria: categoria
                };

                // Adiciona data se for transa√ß√£o
                if (currentEditCollection === 'transacoes') {
                    const dataValue = form.querySelector('#editData').value;
                    if (!isValidDate(dataValue)) {
                        showToast('Erro', 'Data inv√°lida', 'error');
                        return;
                    }
                    data.data = dataValue;
                }

                await updateItem(currentEditCollection, currentEditId, data);
                closeEditModal();

            } catch (error) {
                console.error('Erro ao atualizar:', error);
            }
        }

        /**
         * Fecha modal de edi√ß√£o
         */
        function closeEditModal() {
            const modal = document.getElementById('editModal');
            if (modal) {
                modal.classList.add('hidden');
            }
            currentEditId = null;
            currentEditCollection = null;
        }

        // ==================== DELETE FUNCTIONS ====================

        /**
         * Confirma exclus√£o de transa√ß√£o
         * @param {string} id - ID da transa√ß√£o
         */
        function deleteTransactionConfirm(id) {
            const transacao = transacoes.find(t => t.id === id);
            if (!transacao) {
                showToast('Erro', 'Transa√ß√£o n√£o encontrada', 'error');
                return;
            }

            openConfirmModal(
                'Confirmar Exclus√£o',
                `Deseja realmente excluir a ${transacao.tipo} "${sanitizeString(transacao.descricao)}" no valor de ${formatBRL(transacao.valor)}?`,
                () => deleteItem('transacoes', id),
                'danger'
            );
        }

        /**
         * Confirma exclus√£o de patrim√¥nio
         * @param {string} id - ID do patrim√¥nio
         */
        function deletePatrimonioConfirm(id) {
            const item = patrimonio.find(p => p.id === id);
            if (!item) {
                showToast('Erro', 'Item n√£o encontrado', 'error');
                return;
            }

            openConfirmModal(
                'Confirmar Exclus√£o',
                `Deseja realmente excluir o ${item.tipo} "${sanitizeString(item.descricao)}" no valor de ${formatBRL(item.valor)}?`,
                () => deleteItem('patrimonio', id),
                'danger'
            );
        }

        // ==================== TAB NAVIGATION ====================

        /**
         * Mostra tab espec√≠fica
         * @param {string} tabName - Nome da tab
         */
        function showTab(tabName) {
            try {
                // Esconde todas as tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.add('hidden');
                });

                // Remove classe ativa de todos os bot√µes
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.className = 'tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-700 whitespace-nowrap hover:bg-gray-200 transition-colors';
                });

                // Mostra tab selecionada
                const selectedTab = document.getElementById(tabName);
                if (selectedTab) {
                    selectedTab.classList.remove('hidden');
                    selectedTab.classList.add('fade-in');
                }

                // Ativa bot√£o da tab
                const selectedBtn = document.querySelector(`[data-tab="${tabName}"]`);
                if (selectedBtn) {
                    selectedBtn.className = 'tab-btn px-4 py-2 rounded-lg text-sm font-medium gradient-info text-white whitespace-nowrap';
                }

                // Salva tab atual
                localStorage.setItem('currentTab', tabName);
            } catch (error) {
                console.error('Erro ao navegar entre tabs:', error);
            }
        }

        // ==================== EXPORT TO WINDOW ====================

        // Exporta fun√ß√µes necess√°rias para o escopo global
        window.loginWithGoogle = loginWithGoogle;
        window.logout = logout;
        window.handleReceitaForm = handleReceitaForm;
        window.handleDespesaForm = handleDespesaForm;
        window.handlePatrimonioForm = handlePatrimonioForm;
        window.formatCurrency = formatCurrency;
        window.showTab = showTab;
        window.editTransaction = editTransaction;
        window.editPatrimonio = editPatrimonio;
        window.deleteTransactionConfirm = deleteTransactionConfirm;
        window.deletePatrimonioConfirm = deletePatrimonioConfirm;
        window.closeConfirmModal = closeConfirmModal;
        window.closeEditModal = closeEditModal;

        // ==================== INICIALIZA√á√ÉO ====================

        // Inicializa quando a p√°gina carrega
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Sistema Financeiro Corrigido Carregado com Sucesso!');

            // Define datas nos campos
            setToday();
        });

    </script>

    <!-- README das Instru√ß√µes de Configura√ß√£o -->
    <div style="display: none;" id="readme">
        <h1>Sistema de Gest√£o Financeira Pessoal - README</h1>

        <h2>üöÄ Configura√ß√£o do Firebase</h2>
        <ol>
            <li>Acesse <a href="https://console.firebase.google.com">Firebase Console</a></li>
            <li>Crie um novo projeto ou use um existente</li>
            <li>Ative Authentication > Sign-in method > Google</li>
            <li>Ative Firestore Database</li>
            <li>Em Project Settings > General, copie suas credenciais</li>
            <li>Substitua o conte√∫do do script JSON com suas credenciais</li>
            <li>Em Authentication > Settings > Authorized domains, adicione seus dom√≠nios</li>
        </ol>

        <h2>üìä Estrutura do Firestore</h2>
        <pre>
users/{uid}/
‚îú‚îÄ‚îÄ transacoes/
‚îÇ   ‚îú‚îÄ‚îÄ {docId}
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tipo: "receita" | "despesa"
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ descricao: string
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ valor: number
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ categoria: string
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data: string (YYYY-MM-DD)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ createdAt: timestamp
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ patrimonio/
    ‚îú‚îÄ‚îÄ {docId}
    ‚îÇ   ‚îú‚îÄ‚îÄ tipo: "bem" | "divida"
    ‚îÇ   ‚îú‚îÄ‚îÄ descricao: string
    ‚îÇ   ‚îú‚îÄ‚îÄ valor: number
    ‚îÇ   ‚îú‚îÄ‚îÄ categoria: string
    ‚îÇ   ‚îî‚îÄ‚îÄ createdAt: timestamp
    ‚îî‚îÄ‚îÄ ...
        </pre>

        <h2>üåê Deploy</h2>
        <h3>GitHub Pages:</h3>
        <ol>
            <li>Fa√ßa upload do arquivo HTML para um reposit√≥rio</li>
            <li>Ative GitHub Pages</li>
            <li>Adicione o dom√≠nio do GitHub Pages aos dom√≠nios autorizados do Firebase</li>
        </ol>

        <h3>Vercel:</h3>
        <ol>
            <li>Conecte seu reposit√≥rio ao Vercel</li>
            <li>Deploy autom√°tico</li>
            <li>Adicione o dom√≠nio do Vercel aos dom√≠nios autorizados</li>
        </ol>

        <h3>Firebase Hosting:</h3>
        <ol>
            <li>npm install -g firebase-tools</li>
            <li>firebase login</li>
            <li>firebase init hosting</li>
            <li>firebase deploy</li>
        </ol>

        <h2>‚ú® Recursos</h2>
        <ul>
            <li>‚úÖ Autentica√ß√£o Google autom√°tica</li>
            <li>‚úÖ Dados em tempo real com onSnapshot</li>
            <li>‚úÖ Valida√ß√£o robusta de entrada</li>
            <li>‚úÖ Formata√ß√£o monet√°ria brasileira</li>
            <li>‚úÖ Gr√°ficos interativos</li>
            <li>‚úÖ Proje√ß√µes financeiras inteligentes</li>
            <li>‚úÖ Interface responsiva</li>
            <li>‚úÖ Edi√ß√£o e exclus√£o de registros</li>
            <li>‚úÖ An√°lise autom√°tica de padr√µes</li>
            <li>‚úÖ Sugest√µes de metas</li>
        </ul>

        <h2>üîß Personaliza√ß√£o</h2>
        <ul>
            <li>Modifique as categorias nos selects dos formul√°rios</li>
            <li>Ajuste as cores nos gradientes CSS</li>
            <li>Personalize os c√°lculos de proje√ß√£o</li>
            <li>Adicione novas an√°lises inteligentes</li>
        </ul>
    </div>
</body>

</html>
